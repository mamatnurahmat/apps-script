<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Laporan Masuk - Admin Panel</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Material Symbols -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#4361ee",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "card-light": "#ffffff",
                        "card-dark": "#1c2a36",
                        "sidebar-light": "#ffffff",
                        "sidebar-dark": "#15202b",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    }
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .lightbox.active {
            opacity: 1;
            pointer-events: auto;
        }

        .lightbox-img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border-radius: 8px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 30px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4361ee;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display transition-colors duration-200">
    <!-- Loading -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img src="" alt="Full Screen" class="lightbox-img" id="lightboxImg">
    </div>

    <div class="flex h-screen w-full overflow-hidden">
        <!-- Sidebar -->
        <aside
            class="hidden md:flex flex-col w-64 h-full bg-sidebar-light dark:bg-sidebar-dark border-r border-slate-200 dark:border-slate-800">
            <div class="p-6">
                <div class="flex items-center gap-3">
                    <div
                        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 shrink-0 bg-primary/10 flex items-center justify-center text-primary font-bold shadow-sm">
                        ST
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-slate-900 dark:text-white text-base font-bold leading-normal">Simantools</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-sm font-normal leading-normal">Admin Panel</p>
                    </div>
                </div>
            </div>
            <div class="flex flex-col flex-1 px-4 gap-2">
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary dark:text-primary transition-colors font-medium"
                    href="#">
                    <span class="material-symbols-outlined">dashboard</span>
                    <span class="text-sm font-medium leading-normal">Laporan Masuk</span>
                </a>
            </div>
            <div class="p-4 border-t border-slate-200 dark:border-slate-800">
                <button onclick="logout()"
                    class="flex w-full items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
                    <span class="material-symbols-outlined">logout</span>
                    <span class="text-sm font-medium leading-normal">Log Out</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col h-full overflow-y-auto relative">
            <!-- Mobile Header -->
            <div
                class="md:hidden flex items-center justify-between p-4 bg-sidebar-light dark:bg-sidebar-dark border-b border-slate-200 dark:border-slate-800 sticky top-0 z-20">
                <div class="flex items-center gap-3">
                    <div
                        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-8 shrink-0 bg-primary/10 flex items-center justify-center text-primary font-bold text-xs">
                        ST</div>
                    <span class="font-bold text-slate-900 dark:text-white">Simantools Admin</span>
                </div>
                <button onclick="logout()" class="text-slate-500">
                    <span class="material-symbols-outlined">logout</span>
                </button>
            </div>

            <div class="max-w-[1400px] w-full mx-auto p-4 md:p-8 flex flex-col gap-6 md:gap-8">
                <!-- Header Banner -->
                <div class="w-full">
                    <div class="bg-cover bg-center flex flex-col justify-end overflow-hidden rounded-xl min-h-[160px] md:min-h-[200px] shadow-sm relative group"
                        style='background-image: linear-gradient(180deg, rgba(67, 97, 238, 0.4) 0%, rgba(16, 25, 34, 0.9) 100%), url("https://images.unsplash.com/photo-1581093458791-9f30b9fa06e8?q=80&w=2670&auto=format&fit=crop");'>
                        <div class="flex flex-col p-6 z-10">
                            <h2 class="text-white tracking-tight text-3xl font-bold leading-tight">Dashboard Laporan
                            </h2>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="relative flex h-3 w-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                                </span>
                                <p class="text-slate-200 text-sm font-medium" id="headerSubtitle">Sinkronisasi data...
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Waiting -->
                    <div
                        class="flex flex-col gap-2 rounded-xl p-5 bg-card-light dark:bg-card-dark border border-slate-200 dark:border-slate-700 shadow-sm relative overflow-hidden group hover:border-primary/50 transition-all">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <span class="material-symbols-outlined text-6xl">hourglass_empty</span>
                        </div>
                        <div class="flex justify-between items-start z-10">
                            <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">Waiting</p>
                            <span class="bg-yellow-500/10 text-yellow-600 p-1.5 rounded-lg">
                                <span class="material-symbols-outlined text-[20px]">hourglass_empty</span>
                            </span>
                        </div>
                        <div class="flex items-end gap-2 mt-2 z-10">
                            <p class="text-slate-900 dark:text-white text-3xl font-bold leading-tight" id="statWaiting">
                                0</p>
                            <p class="text-xs text-slate-400 mb-1">laporan</p>
                        </div>
                    </div>

                    <!-- On Process -->
                    <div
                        class="flex flex-col gap-2 rounded-xl p-5 bg-card-light dark:bg-card-dark border border-slate-200 dark:border-slate-700 shadow-sm relative overflow-hidden group hover:border-blue-500/50 transition-all">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <span class="material-symbols-outlined text-6xl">engineering</span>
                        </div>
                        <div class="flex justify-between items-start z-10">
                            <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">On Process</p>
                            <span class="bg-blue-500/10 text-blue-600 p-1.5 rounded-lg">
                                <span class="material-symbols-outlined text-[20px]">engineering</span>
                            </span>
                        </div>
                        <div class="flex items-end gap-2 mt-2 z-10">
                            <p class="text-slate-900 dark:text-white text-3xl font-bold leading-tight" id="statProcess">
                                0</p>
                            <p class="text-xs text-slate-400 mb-1">laporan</p>
                        </div>
                    </div>

                    <!-- Done -->
                    <div
                        class="flex flex-col gap-2 rounded-xl p-5 bg-card-light dark:bg-card-dark border border-slate-200 dark:border-slate-700 shadow-sm relative overflow-hidden group hover:border-emerald-500/50 transition-all">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <span class="material-symbols-outlined text-6xl">check_circle</span>
                        </div>
                        <div class="flex justify-between items-start z-10">
                            <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">Completed</p>
                            <span class="bg-emerald-500/10 text-emerald-600 p-1.5 rounded-lg">
                                <span class="material-symbols-outlined text-[20px]">check_circle</span>
                            </span>
                        </div>
                        <div class="flex items-end gap-2 mt-2 z-10">
                            <p class="text-slate-900 dark:text-white text-3xl font-bold leading-tight" id="statDone">0
                            </p>
                            <p class="text-xs text-slate-400 mb-1">laporan</p>
                        </div>
                    </div>
                </div>

                <!-- Reports Table Section -->
                <div
                    class="bg-card-light dark:bg-card-dark rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col">
                    <div
                        class="p-6 border-b border-slate-200 dark:border-slate-700 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Daftar Laporan</h2>
                        <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                            <div class="relative w-full sm:w-64">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="material-symbols-outlined text-slate-400">search</span>
                                </div>
                                <input id="searchInput"
                                    class="block w-full pl-10 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg leading-5 bg-white dark:bg-slate-800 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary sm:text-sm"
                                    placeholder="Cari laporan..." type="text" />
                            </div>
                            <select id="statusFilter"
                                class="block w-full sm:w-40 pl-3 pr-10 py-2 border border-slate-300 dark:border-slate-600 rounded-lg leading-5 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary sm:text-sm">
                                <option value="Waiting" selected>Waiting</option>
                                <option value="On Process">On Process</option>
                                <option value="Done">Done</option>
                                <option value="">Semua Status</option>
                            </select>
                            <button onclick="loadData()"
                                class="flex items-center justify-center p-2 rounded-lg bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 transition-colors text-slate-600 dark:text-slate-300">
                                <span class="material-symbols-outlined">refresh</span>
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                            <thead class="bg-slate-50 dark:bg-slate-800">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                        ID / Waktu</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                        Alat & Keluhan</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                        Pelapor</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                        Status</th>
                                    <th
                                        class="px-6 py-3 text-right text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                                        Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"
                                class="bg-card-light dark:bg-card-dark divide-y divide-slate-200 dark:divide-slate-700">
                                <!-- Rows generated by JS -->
                            </tbody>
                        </table>

                        <!-- Empty State -->
                        <div id="emptyState"
                            class="hidden flex flex-col items-center justify-center py-12 px-4 text-center">
                            <div class="bg-slate-100 dark:bg-slate-800 p-4 rounded-full mb-3">
                                <span class="material-symbols-outlined text-4xl text-slate-400">content_paste_off</span>
                            </div>
                            <h3 class="text-slate-900 dark:text-white font-medium mb-1">Tidak ada laporan</h3>
                            <p class="text-slate-500 text-sm">Cobalah ubah filter pencarian Anda.</p>
                        </div>
                    </div>

                    <!-- Pagination Footer (placeholder) -->
                    <div
                        class="px-6 py-4 border-t border-slate-200 dark:border-slate-700 flex items-center justify-between">
                        <p class="text-sm text-slate-500 dark:text-slate-400" id="showingText">Menampilkan 0 data</p>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // === Logic Script ===
        let allData = [];
        let currentUser = null;

        // Lightbox
        function openLightbox(url) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            img.src = url;
            lightbox.classList.add('active');
        }
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        document.addEventListener('DOMContentLoaded', function () {
            loadData();
            // Setup inputs
            document.getElementById('searchInput').addEventListener('input', filterData);
            document.getElementById('statusFilter').addEventListener('change', filterData);
        });

        function loadData() {
            showLoading();
            google.script.run
                .withSuccessHandler(function (data) {
                    hideLoading();
                    allData = data.reverse();
                    updateStats();
                    checkLoginStatus();
                })
                .withFailureHandler(function (error) {
                    hideLoading();
                    Swal.fire('Error', 'Gagal memuat data: ' + error.message, 'error');
                })
                .getLaporanData();
        }

        function checkLoginStatus() {
            const userStr = sessionStorage.getItem('user');
            if (userStr) {
                currentUser = JSON.parse(userStr);
            }
            filterData();
        }

        function isAdmin() {
            if (currentUser && currentUser.role === 'Admin') return true;
            return true; // Default true for now based on context
        }

        function logout() {
            sessionStorage.removeItem('user');
            google.script.run.withSuccessHandler(function (url) {
                window.top.location.href = url;
            }).getBaseUrl();
        }


        function updateStats() {
            const waiting = allData.filter(d => d.status === 'Waiting').length;
            const process = allData.filter(d => d.status === 'On Process').length;
            const done = allData.filter(d => d.status === 'Done').length;
            const total = allData.length;

            document.getElementById('statWaiting').textContent = waiting;
            document.getElementById('statProcess').textContent = process;
            document.getElementById('statDone').textContent = done;
            document.getElementById('headerSubtitle').textContent = `Sinkronisasi selesai. Total ${total} laporan.`;
            document.getElementById('showingText').textContent = `Menampilkan ${total} data`;
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            const emptyState = document.getElementById('emptyState');

            if (data.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');

            const now = new Date();

            tbody.innerHTML = data.map(item => {
                const statusClass = item.status === 'Waiting' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300' :
                    item.status === 'On Process' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300' :
                        'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300';

                let actionBtn = '-';
                if (isAdmin()) {
                    if (item.status === 'Waiting') {
                        actionBtn = `<button onclick="updateStatus('${item.laporanId}', '${item.id}', 'On Process')" class="bg-primary hover:bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors shadow-sm flex items-center gap-1"><span class="material-symbols-outlined text-[14px]">settings</span> Kerjakan</button>`;
                    } else if (item.status === 'On Process') {
                        actionBtn = `<button onclick="updateStatus('${item.laporanId}', '${item.id}', 'Done')" class="bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors shadow-sm flex items-center gap-1"><span class="material-symbols-outlined text-[14px]">check</span> Selesai</button>`;
                    } else {
                        actionBtn = `<span class="text-emerald-500 flex items-center gap-1 text-xs"><span class="material-symbols-outlined text-[14px]">verified</span> Selesai</span>`;
                    }
                }

                // Response Time Check
                let warningHtml = '';
                if (item.status === 'Waiting' && item.tanggal) {
                    // item.tanggal format example: 2026-02-04 18:00
                    // We need to parse this manually to cross-browser safe Date
                    // Format: yyyy-MM-dd HH:mm
                    const dateParts = item.tanggal.split(' ');
                    if (dateParts.length === 2) {
                        const dateStr = dateParts[0] + 'T' + dateParts[1] + ':00'; // Append seconds for ISO format
                        const reportTime = new Date(dateStr);
                        if (!isNaN(reportTime.getTime())) {
                            const diffMs = now - reportTime;
                            const diffMins = Math.floor(diffMs / 60000);

                            // Warning if more than 15 minutes
                            if (diffMins > 15) {
                                warningHtml = `
                                    <div class="mt-2 text-xs text-red-600 dark:text-red-400 font-bold flex items-center gap-1 bg-red-50 dark:bg-red-900/20 p-1.5 rounded animate-pulse border border-red-200 dark:border-red-800">
                                        <span class="material-symbols-outlined text-[16px]">warning</span>
                                        Late Response (${diffMins} min)
                                    </div>
                                `;
                            }
                        }
                    }
                }

                // Photo
                let photoHtml = '';
                if (item.gambar) {
                    photoHtml = `<div class="mt-2 text-xs text-primary cursor-pointer hover:underline flex items-center gap-1" onclick="openLightbox('${item.gambar}')">
                        <span class="material-symbols-outlined text-[14px]">image</span> Lihat Foto
                    </div>`;
                }

                return `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors group">
                    <td class="px-6 py-4 whitespace-nowrap align-top">
                        <div class="text-sm font-bold text-primary">#${item.laporanId}</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">${item.tanggal || '-'}</div>
                        ${warningHtml}
                    </td>
                    <td class="px-6 py-4 align-top">
                        <div class="flex items-start">
                            <div class="h-8 w-8 rounded bg-slate-100 dark:bg-slate-700 flex items-center justify-center mr-3 text-slate-500 shrink-0">
                                <span class="material-symbols-outlined text-[18px]">medical_services</span>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-slate-900 dark:text-white">${item.alat}</div>
                                <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">${item.kode || ''}</div>
                                <div class="text-sm text-slate-600 dark:text-slate-300 mt-2 p-2 bg-slate-50 dark:bg-slate-800 rounded border border-slate-100 dark:border-slate-700 italic">
                                    "${item.keluhan}"
                                </div>
                                ${photoHtml}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 align-top">
                        <div class="text-sm font-medium text-slate-900 dark:text-white">${item.pelapor}</div>
                         <div class="flex items-center gap-1 mt-1 text-xs text-slate-500">
                            <span class="material-symbols-outlined text-[14px]">location_on</span>
                            ${item.ruangan}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap align-top">
                        <span class="px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right align-top text-sm font-medium">
                        ${actionBtn}
                        ${item.status === 'Done' ? `<div class="text-xs text-slate-400 mt-1">Selesai</div>` : ''}
                    </td>
                </tr>
                `;
            }).join('');
        }

        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const filtered = allData.filter(item => {
                const matchesSearch =
                    (item.laporanId && item.laporanId.toLowerCase().includes(searchTerm)) ||
                    (item.alat && item.alat.toLowerCase().includes(searchTerm)) ||
                    (item.pelapor && item.pelapor.toLowerCase().includes(searchTerm)) ||
                    (item.ruangan && item.ruangan.toLowerCase().includes(searchTerm)) ||
                    (item.keluhan && item.keluhan.toLowerCase().includes(searchTerm));

                const matchesStatus = statusFilter === '' || item.status === statusFilter;
                return matchesSearch && matchesStatus;
            });

            renderTable(filtered);
            document.getElementById('showingText').textContent = `Menampilkan ${filtered.length} data`;
        }

        function updateStatus(displayId, rowId, newStatus) {
            let confirmTitle = '';
            let confirmText = '';
            let confirmButtonText = '';
            let confirmButtonColor = '';

            if (newStatus === 'On Process') {
                confirmTitle = 'Mulai Pengerjaan?';
                confirmText = `Laporan #${displayId} akan ditandai sedang dikerjakan.`;
                confirmButtonText = 'Ya, Mulai';
                confirmButtonColor = '#4361ee';
            } else if (newStatus === 'Done') {
                confirmTitle = 'Selesaikan Laporan?';
                confirmText = `Laporan #${displayId} akan ditandai selesai.`;
                confirmButtonText = 'Ya, Selesai';
                confirmButtonColor = '#10b981';
            }

            Swal.fire({
                title: confirmTitle,
                text: confirmText,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: confirmButtonColor,
                cancelButtonColor: '#ef4444',
                confirmButtonText: confirmButtonText,
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    showLoading();
                    google.script.run
                        .withSuccessHandler(function (response) {
                            hideLoading();
                            if (response.success) {
                                Swal.fire({
                                    title: 'Berhasil!',
                                    text: response.message,
                                    icon: 'success',
                                    timer: 1500,
                                    showConfirmButton: false
                                });
                                loadData();
                            } else {
                                Swal.fire('Gagal!', response.message, 'error');
                            }
                        })
                        .withFailureHandler(function (error) {
                            hideLoading();
                            Swal.fire('Error', error.message, 'error');
                        })
                        .updateLaporanStatus(rowId, newStatus);
                }
            });
        }

        function showLoading() { document.getElementById('loadingOverlay').style.display = 'flex'; }
        function hideLoading() { document.getElementById('loadingOverlay').style.display = 'none'; }
    </script>
</body>

</html>